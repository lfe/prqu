(defmodule prqu-util
  (export all))

(include-lib "deps/yaws/include/yaws_api.hrl")

(defun get-prqu-version ()
  (lfe-utils:get-app-src-version '"src/prqu.app.src"))

(defun get-version ()
  (++ (lfe-utils:get-version)
      `(#(prqu ,(get-prqu-version)))))

(defun get-apps ()
  (lists:sort
    (lists:map
      (lambda (x) (element 1 x))
      (application:which_applications))))

(defun get-running ()
  (lists:sort
    (sets:to_list
      (sets:intersection
        (sets:from_list (get-apps))
        (sets:from_list '(econfig gproc))))))

(defun running? ()
  (case (get-running)
    ('() 'false)
    (_ 'true)))

(defun parse-path (arg-data)
  "Get pathinfo. This is used as the key to refer to specific preferences.

  Note that this function uses macros generated by LFE when theh yaws_api.hrl
  file is parsed."
  (arg-pathinfo arg-data))

(defun make-result (payload)
  (make-result 200 payload))

(defun make-result (status-code payload)
  `(#(status ,status-code) ,payload))

(defun make-result (status-code payload headers)
  (++ (make-result status-code payload) headers))

(defun make-html-result (status-code html-data)
  "Return an HTML payload for the given data."
  `#(content "text/html" ,html-data))

(defun make-200-result (html-data)
  "OK."
  (make-html-result 200 html-data))

(defun make-404-result (html-data)
  "NOT-FOUND."
  (make-html-result 404 html-data))
